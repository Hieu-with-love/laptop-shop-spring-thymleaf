<!doctype html>
<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org">


<!-- Mirrored from new.axilthemes.com/demo/template/etrade/cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 14 Oct 2024 00:33:29 GMT -->
<head>
    <title>Laptop Shop || Cart</title>
    <div th:insert="~{common-user/head::head}"></div>
    <link rel="stylesheet"
          th:href="@{/etrade/assets/css/my-style.css}"
    />
</head>


<body class="sticky-header">
<!-- Start Header -->
<div th:insert="~{common-user/header-style-5::header}"></div>

<!-- End Header -->

<main class="main-wrapper">

    <!-- Start Cart Area  -->
    <div class="axil-product-cart-area axil-section-gap">
        <div class="container">
            <div class="axil-product-cart-wrap">
                <div class="product-table-heading">
                    <h4 class="title">Your Cart</h4>
                    <form id="form-clear-cart">
                        <input type="hidden" id="cartId" th:value="${session.cartId}">
                        <button type="submit" class="cart-clear">
                            Clear Shopping Cart
                        </button>
                    </form>
                </div>
                <div id="items-container" class="table-responsive">
                    <input type="hidden" id="isCartEmpty" th:value="${cartEmpty}">

                    <table class="table axil-product-table axil-cart-table mb--40">
                        <thead>
                        <tr>
                            <th scope="col" class="product-remove"></th>
                            <th scope="col" class="product-thumbnail">Thumbnail</th>
                            <th scope="col" class="product-title">Product Name</th>
                            <th scope="col" class="product-price">Price</th>
                            <th scope="col" class="product-quantity">Quantity</th>
                            <th scope="col" class="product-subtotal">Subtotal</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="item : ${listItems}">
                            <td class="product-remove">
                                <form th:action="@{/user/cart/remove}" class="remove-item">
                                    <input type="hidden" name="cartId" th:value="${session.cartId}"/>
                                    <input type="hidden" name="productId" th:value="${item.productId}"/>
                                    <button type="submit" class="remove-wishlist">
                                        <i class="fal fa-times"></i>
                                    </button>
                                </form>
                            </td>
                            <td class="product-thumbnail"><a th:href="@{/user/product/detail}"><img
                                    th:src="@{'/uploads/' + ${item.images}}" alt="Digital Product"></a>
                            </td>
                            <td class="product-title" th:text="${item.productName}"><a
                                    th:href="@{/user/product/detail}"></a>
                            </td>
                            <td class="product-price" data-title="Price" th:text="${item.unitPrice}"><span
                                    class="currency-symbol">VNĐ</span>
                            </td>
                            <td class="product-quantity" data-title="Qty">
                                <div class="pro-qty">
                                    <form th:action="@{/user/cart/dec-qty}" method="post"
                                          class="cart-action" id="form-cart-dec">
                                        <input type="hidden" name="cartId" th:value="${session.cartId}"/>
                                        <input type="hidden" name="productId" th:value="${item.productId}"/>
                                        <button type="submit" class="dec qtybtn">-</button>
                                    </form>
                                    <input type="number" id="quantity-inc" class="quantity-input"
                                           th:value="${item.quantity}">
                                    <form th:action="@{/user/cart/inc-qty}" method="post"
                                          class="cart-action" id="form-cart-inc">
                                        <input type="hidden" name="cartId" th:value="${session.cartId}"/>
                                        <input type="hidden" name="productId" th:value="${item.productId}"/>
                                        <button type="submit" class="inc qtybtn">+</button>
                                    </form>
                                </div>
                            </td>
                            <td class="product-subtotal" data-title="Subtotal" th:text="${item.totalPrice}"><span
                                    class="currency-symbol">VNĐ</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="cart-empty-message" style="display: none;">
                    <div class="empty-notification">
                        <img th:src="@{/etrade/assets/images/my-img/empty-cart-yellow.png}" alt="Empty Cart">
                        <p>Browse our catalog to add your favorite products to your cart!</p>
                        <a href="/user" class="btn btn-primary">Continue Shopping</a>
                    </div>
                </div>

                <div class="cart-update-btn-area">
                    <div class="input-group product-cupon">
                        <input placeholder="Enter coupon code" type="text">
                        <div class="product-cupon-btn">
                            <button type="submit" class="axil-btn btn-outline">Apply</button>
                        </div>
                    </div>
                    <div class="update-btn">
                        <a th:href="@{/user}" class="axil-btn btn-outline">Update Cart</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-5 col-lg-7 offset-xl-7 offset-lg-5">
                        <div class="axil-order-summery mt--80">
                            <h5 class="title mb--20">Order Summary</h5>
                            <div class="summery-table-wrap">
                                <table class="table summery-table mb--30">
                                    <tbody>
                                    <tr class="order-subtotal">
                                        <td>Subtotal</td>
                                        <td th:each="item : ${listItems}">
                                            <p th:text="${item.totalPrice}"></p>
                                        </td>
                                    </tr>
                                    <tr class="order-shipping">
                                        <td>Shipping</td>
                                        <td>
                                            <div class="input-group">
                                                <input type="radio" id="radio1" name="shipping" checked>
                                                <label for="radio1">Free Shippping</label>
                                            </div>
                                            <div class="input-group">
                                                <input type="radio" id="radio2" name="shipping">
                                                <label for="radio2">Local: $35.00</label>
                                            </div>
                                            <div class="input-group">
                                                <input type="radio" id="radio3" name="shipping">
                                                <label for="radio3">Flat rate: $12.00</label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="order-tax">
                                        <td>State Tax</td>
                                        <td>$8.00</td>
                                    </tr>
                                    <tr class="order-total">
                                        <td>Total</td>
                                        <td class="order-total-amount" th:text="${cart.totalAmount}"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <a th:href="@{/user/checkout}"
                               class="axil-btn btn-bg-primary checkout-btn">Process to
                                Checkout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Cart Area  -->

</main>

<div th:insert="~{common-user/content::service-area}"></div>

<div th:insert="~{common-user/footer::footer}"></div>


<!-- Product Quick View Modal Start -->
<div class="modal fade quick-view-product" id="quick-view-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i
                        class="far fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="single-product-thumb">
                    <div class="row">
                        <div class="col-lg-7 mb--40">
                            <div class="row">
                                <div class="col-lg-10 order-lg-2">
                                    <div class="single-product-thumbnail product-large-thumbnail axil-product thumbnail-badge zoom-gallery">
                                        <div class="thumbnail">
                                            <img src="assets/images/product/product-big-01.png" alt="Product Images">
                                            <div class="label-block label-right">
                                                <div class="product-badget">20% OFF</div>
                                            </div>
                                            <div class="product-quick-view position-view">
                                                <a href="assets/images/product/product-big-01.png" class="popup-zoom">
                                                    <i class="far fa-search-plus"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="thumbnail">
                                            <img src="assets/images/product/product-big-02.png" alt="Product Images">
                                            <div class="label-block label-right">
                                                <div class="product-badget">20% OFF</div>
                                            </div>
                                            <div class="product-quick-view position-view">
                                                <a href="assets/images/product/product-big-02.png" class="popup-zoom">
                                                    <i class="far fa-search-plus"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="thumbnail">
                                            <img src="assets/images/product/product-big-03.png" alt="Product Images">
                                            <div class="label-block label-right">
                                                <div class="product-badget">20% OFF</div>
                                            </div>
                                            <div class="product-quick-view position-view">
                                                <a href="assets/images/product/product-big-03.png" class="popup-zoom">
                                                    <i class="far fa-search-plus"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-2 order-lg-1">
                                    <div class="product-small-thumb small-thumb-wrapper">
                                        <div class="small-thumb-img">
                                            <img src="assets/images/product/product-thumb/thumb-08.png"
                                                 alt="thumb image">
                                        </div>
                                        <div class="small-thumb-img">
                                            <img src="assets/images/product/product-thumb/thumb-07.png"
                                                 alt="thumb image">
                                        </div>
                                        <div class="small-thumb-img">
                                            <img src="assets/images/product/product-thumb/thumb-09.png"
                                                 alt="thumb image">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5 mb--40">
                            <div class="single-product-content">
                                <div class="inner">
                                    <div class="product-rating">
                                        <div class="star-rating">
                                            <img src="assets/images/icons/rate.png" alt="Rate Images">
                                        </div>
                                        <div class="review-link">
                                            <a href="#">(<span>1</span> customer reviews)</a>
                                        </div>
                                    </div>
                                    <h3 class="product-title">Serif Coffee Table</h3>
                                    <span class="price-amount">$155.00 - $255.00</span>
                                    <ul class="product-meta">
                                        <li><i class="fal fa-check"></i>In stock</li>
                                        <li><i class="fal fa-check"></i>Free delivery available</li>
                                        <li><i class="fal fa-check"></i>Sales 30% Off Use Code: MOTIVE30</li>
                                    </ul>
                                    <p class="description">In ornare lorem ut est dapibus, ut tincidunt nisi pretium.
                                        Integer ante est, elementum eget magna. Pellentesque sagittis dictum libero, eu
                                        dignissim tellus.</p>

                                    <div class="product-variations-wrapper">

                                        <!-- Start Product Variation  -->
                                        <div class="product-variation">
                                            <h6 class="title">Colors:</h6>
                                            <div class="color-variant-wrapper">
                                                <ul class="color-variant mt--0">
                                                    <li class="color-extra-01 active"><span><span class="color"></span></span>
                                                    </li>
                                                    <li class="color-extra-02"><span><span class="color"></span></span>
                                                    </li>
                                                    <li class="color-extra-03"><span><span class="color"></span></span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- End Product Variation  -->

                                        <!-- Start Product Variation  -->
                                        <div class="product-variation">
                                            <h6 class="title">Size:</h6>
                                            <ul class="range-variant">
                                                <li>xs</li>
                                                <li>s</li>
                                                <li>m</li>
                                                <li>l</li>
                                                <li>xl</li>
                                            </ul>
                                        </div>
                                        <!-- End Product Variation  -->

                                    </div>

                                    <!-- Start Product Action Wrapper  -->
                                    <div class="product-action-wrapper d-flex-center">
                                        <!-- Start Quentity Action  -->
                                        <div class="pro-qty"><input type="text" value="1"></div>
                                        <!-- End Quentity Action  -->

                                        <!-- Start Product Action  -->
                                        <ul class="product-action d-flex-center mb--0">
                                            <li class="add-to-cart"><a href="cart.html" class="axil-btn btn-bg-primary">Add
                                                to Cart</a></li>
                                            <li class="wishlist"><a href="wishlist.html"
                                                                    class="axil-btn wishlist-btn"><i
                                                    class="far fa-heart"></i></a></li>
                                        </ul>
                                        <!-- End Product Action  -->

                                    </div>
                                    <!-- End Product Action Wrapper  -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Product Quick View Modal End -->

<!-- Header Search Modal End -->
<div class="header-search-modal" id="header-search-modal">
    <button class="card-close sidebar-close"><i class="fas fa-times"></i></button>
    <div class="header-search-wrap">
        <div class="card-header">
            <form action="#">
                <div class="input-group">
                    <input type="search" class="form-control" name="prod-search" id="prod-search"
                           placeholder="Write Something....">
                    <button type="submit" class="axil-btn btn-bg-primary"><i class="far fa-search"></i></button>
                </div>
            </form>
        </div>
        <div class="card-body">
            <div class="search-result-header">
                <h6 class="title">24 Result Found</h6>
                <a href="shop.html" class="view-all">View All</a>
            </div>
            <div class="psearch-results">
                <div class="axil-product-list">
                    <div class="thumbnail">
                        <a href="single-product.html">
                            <img src="assets/images/product/electric/product-09.png" alt="Yantiti Leather Bags">
                        </a>
                    </div>
                    <div class="product-content">
                        <div class="product-rating">
                                <span class="rating-icon">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fal fa-star"></i>
                            </span>
                            <span class="rating-number"><span>100+</span> Reviews</span>
                        </div>
                        <h6 class="product-title"><a href="single-product.html">Media Remote</a></h6>
                        <div class="product-price-variant">
                            <span class="price current-price">$29.99</span>
                            <span class="price old-price">$49.99</span>
                        </div>
                        <div class="product-cart">
                            <a href="cart.html" class="cart-btn"><i class="fal fa-shopping-cart"></i></a>
                            <a href="wishlist.html" class="cart-btn"><i class="fal fa-heart"></i></a>
                        </div>
                    </div>
                </div>
                <div class="axil-product-list">
                    <div class="thumbnail">
                        <a href="single-product.html">
                            <img src="assets/images/product/electric/product-09.png" alt="Yantiti Leather Bags">
                        </a>
                    </div>
                    <div class="product-content">
                        <div class="product-rating">
                                <span class="rating-icon">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fal fa-star"></i>
                            </span>
                            <span class="rating-number"><span>100+</span> Reviews</span>
                        </div>
                        <h6 class="product-title"><a href="single-product.html">Media Remote</a></h6>
                        <div class="product-price-variant">
                            <span class="price current-price">$29.99</span>
                            <span class="price old-price">$49.99</span>
                        </div>
                        <div class="product-cart">
                            <a href="cart.html" class="cart-btn"><i class="fal fa-shopping-cart"></i></a>
                            <a href="wishlist.html" class="cart-btn"><i class="fal fa-heart"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Header Search Modal End -->

<div th:insert="~{/common-user/cart-dropdown::cart-dropdown}"></div>

<div th:insert="~{common-user/script::script}"></div>

<script>
    $(document).ready(function () {
        const isCartEmpty = $('#isCartEmpty').val() === 'true'
        if (isCartEmpty) {
            $('#items-container').hide();
            $('#cart-empty-message').fadeIn();
        } else {
            $('#items-container').show();
        }
    });

    $(document).on('submit', '#form-clear-cart', function (event) {
        event.preventDefault(); // Ngăn hành vi submit mặc định

        const $form = $(this);
        const cartId = $form.find('#cartId').val(); // Lấy giá trị cartId từ input

        if (!cartId) {
            alert("Cart ID không hợp lệ!");
            return;
        }

        $.ajax({
            url: '/user/cart/clearCart', // Endpoint API
            method: 'POST', // Phương thức HTTP
            data: {cartId: cartId}, // Dữ liệu gửi lên server
            success: function (response) {
                alert(response); // Hiển thị thông báo thành công
                $('#items-container').hide(); // Ẩn giỏ hàng
                $('#cart-empty-message').fadeIn(); // Hiển thị thông báo giỏ hàng trống
            },
            error: function (xhr) {
                alert(xhr.responseText || 'Có lỗi xảy ra. Vui lòng thử lại!');
            }
        });
    });

    $(document).on('submit', '.remove-item', function (event) {
        event.preventDefault(); // Ngăn form submit mặc định
        const $form = $(this); // Form hiện tại
        const cartId = $form.find('input[name="cartId"]').val();
        const productId = $form.find('input[name="productId"]').val();

        // Gửi yêu cầu AJAX DELETE
        $.ajax({
            url: '/user/cart/remove',
            type: 'DELETE',
            data: {cartId: cartId, productId: productId},
            success: function (response) {
                alert(response); // Hiển thị thông báo thành công
                $form.closest('tr').remove();

                // Kiểm tra nếu giỏ hàng trống
                if ($('#items-container table tbody tr').length === 0) {
                    $('#items-container table').hide();
                    $('#cart-empty-message').fadeIn();
                }
            },
            error: function (xhr) {
                alert(xhr.responseText || 'Có lỗi xảy ra, vui lòng thử lại.');
            }
        });
    });

    $(document).on('submit', '#form-cart-inc', function (e) {
        e.preventDefault();

        const $form = $(this);
        const cartId = $form.find('input[name="cartId"]').val();
        const productId = $form.find('input[name="productId"]').val();

        $.ajax({
            url: "/user/cart/inc-qty",
            type: 'POST',
            data: {cartId: cartId, productId: productId},
            success: function (res) {
                const $quantityInput = $form.closest('.pro-qty').find('.quantity-input');
                $quantityInput.val(res.quantity); // Gán số lượng mới
                alert(res);
            },
            error(e) {
                console.log(e.message());
                alert(e.message())
            }
        })
    });

    $(document).on('submit', '#form-cart-dec', function (e) {
        e.preventDefault();

        const $form = $(this);
        const cartId = $form.find('input[name="cartId"]').val();
        const productId = $form.find('input[name="productId"]').val();

        $.ajax({
            url: "/user/cart/dec-qty",
            type: 'POST',
            data: {cartId: cartId, productId: productId},
            success: function (res) {
                if (res.quantity > 1) {
                    const $quantityInput = $form.closest('.pro-qty').find('.quantity-input');
                    $quantityInput.val(res.quantity); // Gán giá trị mới
                    alert(res.message + " : " + res.quantity);
                } else {
                    alert("Khong the tru duoc nua!");
                }
            },
            error(e) {
                console.log(e.message());
                alert(e.message())
            }
        })
    });


</script>

</body>
</html>